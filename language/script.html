<!DOCTYPE html>
<html lang="te">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Single Stroke Telugu Tracing</title>

<script src="https://cdn.jsdelivr.net/npm/opentype.js@latest/dist/opentype.min.js"></script>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#f4fbff;
    text-align:center;
}
h1{margin:15px 0 5px;}

#progress{
    font-weight:bold;
    margin-bottom:8px;
}

svg{
    width:95%;
    max-width:500px;
    height:420px;
    background:white;
    border-radius:15px;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
    touch-action:none;
}

.guide{
    fill:none;
    stroke:#cccccc;
    stroke-width:6;
    stroke-linecap:round;
    stroke-linejoin:round;
}

.trace{
    fill:none;
    stroke:#4CAF50;
    stroke-width:6;
    stroke-linecap:round;
    stroke-linejoin:round;
}

#glider{
    fill:#ff5722;
}

button{
    padding:8px 18px;
    margin:8px;
    border:none;
    border-radius:8px;
    font-size:16px;
    background:#4CAF50;
    color:white;
}
button:hover{ background:#388e3c; }

#message{
    font-size:18px;
    color:green;
    margin-top:5px;
}
</style>
</head>

<body>

<h1>తెలుగు సింగిల్ స్ట్రోక్ ట్రేసింగ్</h1>
<div id="progress"></div>

<svg id="svg" viewBox="0 0 500 420">
    <path id="guide" class="guide"></path>
    <path id="trace" class="trace"></path>
    <circle id="glider" r="8"></circle>
</svg>

<div>
    <button onclick="prevLetter()">Previous</button>
    <button onclick="resetTracing()">Reset</button>
    <button onclick="nextLetter()">Next</button>
</div>

<div id="message"></div>

<script>

const letters = [
"అ","ఆ","ఇ","ఈ","ఉ","ఊ","ఋ","ౠ","ఎ","ఏ","ఐ","ఒ","ఓ","ఔ","అం","అః",
"క","ఖ","గ","ఘ","ఙ",
"చ","ఛ","జ","ఝ","ఞ",
"ట","ఠ","డ","ఢ","ణ",
"త","థ","ద","ధ","న",
"ప","ఫ","బ","భ","మ",
"య","ర","ల","వ",
"శ","ష","స","హ",
"ళ","క్ష","ఱ"
];

let font;
let current = 0;
let totalLength = 0;
let currentLength = 0;
let dragging = false;

const guide = document.getElementById("guide");
const trace = document.getElementById("trace");
const glider = document.getElementById("glider");
const svg = document.getElementById("svg");
const progress = document.getElementById("progress");
const message = document.getElementById("message");

opentype.load(
'https://raw.githubusercontent.com/googlefonts/noto-fonts/main/hinted/ttf/NotoSansTelugu/NotoSansTelugu-Regular.ttf',
function(err, loadedFont){
    if(err){
        alert("Font failed to load.");
    }else{
        font = loadedFont;
        loadLetter();
    }
});

function getOuterContour(letter){

    const fontSize = 300;
    const path = font.getPath(letter, 50, 330, fontSize);

    // Take only first contour (outer shape)
    const commands = path.commands;
    let outerPath = "";
    let started = false;

    for(let cmd of commands){
        if(cmd.type === "M" && !started){
            outerPath += `M${cmd.x} ${cmd.y} `;
            started = true;
        }
        else if(started && cmd.type !== "Z"){
            if(cmd.type === "L")
                outerPath += `L${cmd.x} ${cmd.y} `;
            if(cmd.type === "C")
                outerPath += `C${cmd.x1} ${cmd.y1}, ${cmd.x2} ${cmd.y2}, ${cmd.x} ${cmd.y} `;
            if(cmd.type === "Q")
                outerPath += `Q${cmd.x1} ${cmd.y1}, ${cmd.x} ${cmd.y} `;
        }
        else if(cmd.type === "Z"){
            break; // stop after first contour
        }
    }

    return outerPath;
}

function loadLetter(){
    message.textContent="";
    currentLength = 0;

    const pathData = getOuterContour(letters[current]);
    guide.setAttribute("d", pathData);
    trace.setAttribute("d", pathData);

    totalLength = guide.getTotalLength();

    guide.style.strokeDasharray = totalLength;
    guide.style.strokeDashoffset = 0;

    trace.style.strokeDasharray = totalLength;
    trace.style.strokeDashoffset = totalLength;

    const start = guide.getPointAtLength(0);
    glider.setAttribute("cx", start.x);
    glider.setAttribute("cy", start.y);

    progress.textContent = `Letter ${current+1} of ${letters.length} : ${letters[current]}`;
}

function updateGlider(){
    const point = guide.getPointAtLength(currentLength);
    glider.setAttribute("cx", point.x);
    glider.setAttribute("cy", point.y);
    trace.style.strokeDashoffset = totalLength - currentLength;

    if(currentLength >= totalLength * 0.95){
        message.textContent = "Well done!";
        beep();
    }
}

function startDrag(){ dragging = true; }
function stopDrag(){ dragging = false; }

function drag(e){
    if(!dragging) return;
    e.preventDefault();

    currentLength += 4;
    if(currentLength > totalLength)
        currentLength = totalLength;

    updateGlider();
}

function resetTracing(){
    currentLength = 0;
    trace.style.strokeDashoffset = totalLength;
    const start = guide.getPointAtLength(0);
    glider.setAttribute("cx", start.x);
    glider.setAttribute("cy", start.y);
    message.textContent="";
}

function nextLetter(){
    if(current < letters.length-1){
        current++;
        loadLetter();
    }
}

function prevLetter(){
    if(current > 0){
        current--;
        loadLetter();
    }
}

function beep(){
    const ctx = new (window.AudioContext||window.webkitAudioContext)();
    const osc = ctx.createOscillator();
    osc.connect(ctx.destination);
    osc.frequency.value = 600;
    osc.start();
    osc.stop(ctx.currentTime + 0.1);
}

svg.addEventListener("mousedown", startDrag);
svg.addEventListener("mouseup", stopDrag);
svg.addEventListener("mousemove", drag);
svg.addEventListener("touchstart", startDrag);
svg.addEventListener("touchend", stopDrag);
svg.addEventListener("touchmove", drag);

</script>

</body>
</html>
